<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis</title>
    <link rel="stylesheet" href="analysis-styles.css?v=3">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-items-container">
            <div class="nav-item" onclick="window.location.href='index.html'">오늘의 학습</div>
            <div class="nav-item" style="color: #32FF8A;">분석리포트</div>
            <div class="nav-item">베스트 리라이팅</div>
            <div class="nav-item" onclick="window.location.href='mypage.html'">마이페이지</div>
        </div>
        <div class="nav-icon">[→</div>
    </nav>

    <!-- Main Content -->
    <main class="main">
        <!-- Title Section -->
        <section class="title-section animate-on-scroll">
            <h1 class="main-title">분석 리포트</h1>
            <div class="title-description">
                <p class="description-text">
                    이 리포트는 당신의 언어 능력을 종합적으로 분석하여 어휘 표현력, 문장 구성, 논리적 전개 등 다양한 측면에서의 성취도를 보여줍니다. 
                    각 영역별 세부 분석을 통해 향후 학습 방향을 제시하고, 개선점을 명확히 파악할 수 있습니다.
                </p>
                <div class="word-count">334/400</div>
            </div>
        </section>

        <!-- Analysis Summary Section -->
        <section class="analysis-dashboard animate-on-scroll">
            <h2 class="section-title">분석 대시보드</h2>
            <div class="dashboard-grid">
                <!-- Top Row -->
                <div class="dashboard-row-top">
                    <!-- Left: Vocabulary Score -->
                    <div class="vocabulary-score">
                    <h3 class="subtitle">어휘표현력 총점</h3>
                    <div class="score-highlight">설득 장인</div>
                    <p class="score-description">문장을 설계하고, 단어를 조율하는 감각이 뛰어납니다!</p>
                    
                    <!-- Circular Gauge Chart -->
                    <div class="gauge-container">
                        <svg class="gauge-chart" viewBox="0 0 200 200">
                            <circle class="gauge-background" cx="100" cy="100" r="80" fill="none" stroke="#2a2a2a" stroke-width="40"/>
                            <circle class="gauge-progress" cx="100" cy="100" r="80" fill="none" stroke="#32FF8A" stroke-width="40" 
                                    stroke-dasharray="0 502.4" stroke-linecap="round" transform="rotate(-90 100 100)"/>
                        </svg>
                        <div class="gauge-text">
                            <span class="gauge-number">0</span>
                            <span class="gauge-max">/100</span>
                        </div>
                    </div>
                </div>

                <!-- Right: Percentile -->
                <div class="percentile">
                    <h3 class="subtitle">성과 백분위</h3>
                    <div class="percentile-details">
                        <div class="percentile-info">
                            <span class="percentile-score">상위 40%</span>
                            <span class="percentile-description">60%의 사용자보다 높은 점수</span>
                        </div>
                        <ul class="percentile-list">
                            <li>대졸 이상, 혹은 독서량이 많은 성인군에서 흔히 볼 수 있는 수준</li>
                            <li>주제에 대한 통찰과 고급 어휘 사용이 돋보임</li>
                        </ul>
                    </div>
                    
                    <!-- Bell Curve Chart -->
                    <div class="bell-curve-container">
                        <canvas id="percentileChart"></canvas>
                        <!-- Animated red dot -->
                        <div class="animated-red-dot" id="animatedRedDot"></div>
                        
                    </div>
                </div>
                </div>

                <!-- Bottom Row -->
                <div class="dashboard-row-bottom">
                    <!-- Bottom Left: Radar Chart -->
                <div class="radar-chart-container">
                    <h3 class="radar-chart-title">분야별 점수</h3>
                    <div class="radar-content">
                        <svg class="radar-chart" viewBox="0 0 400 300">
                            <!-- Grid.svg 이미지를 배경으로 사용 -->
                            <image href="Grid.svg" x="0" y="0" width="400" height="300" preserveAspectRatio="xMidYMid meet"/>
                            
                            <!-- 데이터 막대 (라인) -->
                            <line class="data-bar vocabulary" x1="200" y1="240" x2="200" y2="240"/>
                            <line class="data-bar difficulty" x1="200" y1="240" x2="200" y2="240"/>
                            <line class="data-bar structure"  x1="200" y1="240" x2="200" y2="240"/>
                            <line class="data-bar logic"      x1="200" y1="240" x2="200" y2="240"/>
                        </svg>
                        
                        <!-- Legend -->
                        <div class="radar-legend">
                            <div class="legend-item">
                                <span class="legend-color vocabulary"></span>
                                <div class="legend-content">
                                    <span class="legend-text">어휘 다양성</span>
                                    <span class="legend-score">86<span class="legend-max">/100</span></span>
                                </div>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color difficulty"></span>
                                <div class="legend-content">
                                    <span class="legend-text">어휘 난이도</span>
                                    <span class="legend-score">89<span class="legend-max">/100</span></span>
                                </div>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color structure"></span>
                                <div class="legend-content">
                                    <span class="legend-text">문장 구성</span>
                                    <span class="legend-score">80<span class="legend-max">/100</span></span>
                                </div>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color logic"></span>
                                <div class="legend-content">
                                    <span class="legend-text">논리적 전개</span>
                                    <span class="legend-score">90<span class="legend-max">/100</span></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right: Bar Chart -->
                <div class="bar-chart-container">
                    <h3 class="bar-chart-title">어휘 수준 분석</h3>
                    <div class="bar-chart">
                        <div class="stacked-bar-container">
                            <div class="stacked-bar">
                                <div class="bar-segment grade-a" data-percentage="20"></div>
                                <div class="bar-segment grade-b" data-percentage="45"></div>
                                <div class="bar-segment grade-c" data-percentage="25"></div>
                                <div class="bar-segment foreign" data-percentage="10"></div>
                            </div>
                            <div class="bar-labels">
                                <div class="label-item">
                                    <span class="label-color grade-a"></span>
                                    <span class="label-text">A 등급</span>
                                    <span class="label-percentage">20%</span>
                                </div>
                                <div class="label-item">
                                    <span class="label-color grade-b"></span>
                                    <span class="label-text">B 등급</span>
                                    <span class="label-percentage">45%</span>
                                </div>
                                <div class="label-item">
                                    <span class="label-color grade-c"></span>
                                    <span class="label-text">C 등급</span>
                                    <span class="label-percentage">25%</span>
                                </div>
                                <div class="label-item">
                                    <span class="label-color foreign"></span>
                                    <span class="label-text">외래어</span>
                                    <span class="label-percentage">10%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
            </div>
        </section>

        <!-- Detailed Analysis Results Section -->
        <section class="detailed-analysis animate-on-scroll">
            <h2 class="section-title">상세 분석 결과</h2>
            <div class="vocabulary-analysis">
                <h3 class="subtitle">어휘 난이도 및 수준 분석</h3>
                <p class="analysis-note">아래 어휘들은 <span class="highlight-percent">상위 15%</span>에서 주로 쓰여요!</p>
                
                <!-- Vocabulary Cards -->
                <div class="vocabulary-cards">
                    <div class="vocab-card card-1">
                        <div class="card-word">진정성</div>
                        <div class="card-pos">명사</div>
                        <div class="card-desc">추상적 개념. 철학적 및 윤리적 담론에서 자주 사용</div>
                    </div>
                    <div class="vocab-card card-2">
                        <div class="card-word">익명성</div>
                        <div class="card-pos">명사</div>
                        <div class="card-desc">사회학적 개념. 정보통신 분야와 연계된 고급어</div>
                    </div>
                    <div class="vocab-card card-3">
                        <div class="card-word">팽배하다</div>
                        <div class="card-pos">동사</div>
                        <div class="card-desc">산문/논설문에서 주로 사용되는 고난도 어휘</div>
                    </div>
                    <div class="vocab-card card-4">
                        <div class="card-word">가짜뉴스/AI 이미지</div>
                        <div class="card-pos">명사</div>
                        <div class="card-desc">현대사회적 맥락 반영. 시사적, 정보미디어적 감수성 포함</div>
                    </div>
                    <div class="vocab-card card-5">
                        <div class="card-word">피상적인 관계</div>
                        <div class="card-pos">명사</div>
                        <div class="card-desc">감정과 관계를 설명하는 고급 심리사회적 어휘</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sentence Structure Section -->
        <section class="sentence-structure animate-on-scroll">
            <h3 class="subtitle">문장 구조 및 논리성</h3>
            <p class="structure-note">자신의 생각을 우수하게 표현하시네요!</p>
            <div class="structure-content">
                <p class="structure-text">복잡한 주제를 명확하고 논리적으로 전개하는 능력이 뛰어납니다. 고급 어휘를 적절한 맥락에 배치하여 의미를 명확하게 전달합니다. 문장 간의 연결성이 자연스럽게 유지되어 전체적인 흐름이 매끄럽습니다. 추상적 개념을 구체적인 예시와 함께 설명하여 이해도를 높입니다.</p>
            </div>
        </section>

        <!-- Rewriting Suggestion Section -->
        <section class="rewriting-suggestion animate-on-scroll">
            <h3 class="subtitle">리라이팅 제안</h3>
            <p class="suggestion-note">아래는 <span class="highlight-percent">상위 3%</span> 회원님의 글입니다!</p>
            <div class="suggestion-content">
                <p class="suggestion-text">
                    디지털 시대의 익명성은 양면성을 지닌다. 한편으로는 자유로운 의견 표현을 가능하게 하여 민주주의의 발전에 기여하지만, 
                    다른 한편으로는 책임감 없는 발언과 가짜뉴스의 확산을 조장할 수 있다. 이러한 맥락에서 우리는 익명성의 장단점을 
                    균형 있게 바라보고, 건전한 온라인 문화 조성을 위한 노력이 필요하다.
                </p>
            </div>
        </section>

        <!-- Action Buttons -->
        <div class="action-buttons-container animate-on-scroll">
            <button class="print-button" onclick="window.print()">
                <svg class="print-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                </svg>
                인쇄하기
            </button>
            <button class="home-button" onclick="window.location.href='index.html'">홈으로 가기</button>
            <button class="gpt-button" onclick="analyzeWithGPT()" style="background: #10A37F; color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 8px; cursor: pointer; margin-left: 1rem;">🤖 GPT 분석</button>
        </div>
    </main>

    <!-- api-key.js는 로컬에서만 사용, Vercel에서는 환경변수 사용 -->
    <script src="api-config.js?v=3"></script>
    <script src="analysis-script.js?v=3"></script>
    
    <!-- Test script to check if JavaScript is working -->
    <script>
        console.log('HTML inline script executed!');
        console.log('Current URL:', window.location.href);
        console.log('Search params:', window.location.search);
        
        // Test URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const text = urlParams.get('text');
        const topic = urlParams.get('topic');
        console.log('Text param:', text);
        console.log('Topic param:', topic);
        
        // Test if we can find the title description element
        setTimeout(() => {
            const titleDesc = document.querySelector('.title-description');
            console.log('Title description element found:', titleDesc);
            
            // Try URL parameters first
            if (text && topic && titleDesc) {
                console.log('URL parameters found, updating title description');
                const decodedText = decodeURIComponent(text);
                const decodedTopic = decodeURIComponent(topic);
                
                titleDesc.innerHTML = `
                    <div class="written-topic">
                        ${decodedTopic}
                    </div>
                    <div class="written-text">
                        ${decodedText}
                    </div>
                    <div class="word-count">${decodedText.length}/300</div>
                `;
                console.log('Title description updated successfully from URL parameters');
            } else {
                // Try localStorage as backup
                console.log('URL parameters not found, trying localStorage');
                const storedText = localStorage.getItem('analysis_text');
                const storedTopic = localStorage.getItem('analysis_topic');
                console.log('Stored text:', storedText);
                console.log('Stored topic:', storedTopic);
                
                if (storedText && storedTopic && titleDesc) {
                    console.log('LocalStorage data found, updating title description');
                    titleDesc.innerHTML = `
                        <div class="written-topic">
                            ${storedTopic}
                        </div>
                        <div class="written-text">
                            ${storedText}
                        </div>
                        <div class="word-count">${storedText.length}/300</div>
                    `;
                    console.log('Title description updated successfully from localStorage');
                    
                } else {
                    console.log('No data found in URL parameters or localStorage');
                }
            }
        }, 1000);
        
        // Test function with sample text and complete analysis
        window.testWithSampleText = function() {
            console.log('🧪 테스트 시작 - GPT 토큰 없이 샘플 데이터로 모든 차트 테스트');
            
            // 1. 제목 설명 업데이트
            const titleDesc = document.querySelector('.title-description');
            if (titleDesc) {
                titleDesc.innerHTML = `
                    <div class="written-topic">
                        디지털 시대의 익명성
                    </div>
                    <div class="written-text">
                        디지털 시대의 익명성은 양면성을 지닌다. 한편으로는 자유로운 의견 표현을 가능하게 하여 민주주의의 발전에 기여하지만, 다른 한편으로는 책임감 없는 발언과 가짜뉴스의 확산을 조장할 수 있다. 이러한 맥락에서 우리는 익명성의 장단점을 균형 있게 바라보고, 건전한 온라인 문화 조성을 위한 노력이 필요하다.
                    </div>
                    <div class="word-count">287/300</div>
                `;
                console.log('✅ 제목 설명 업데이트 완료');
            }
            
            
            // 3. 랜덤 샘플 분석 결과 생성 (매번 다른 결과)
            const generateRandomScore = () => Math.floor(Math.random() * 40) + 60; // 60-100점
            const generateRandomPercentile = () => Math.floor(Math.random() * 60) + 20; // 20-80번째 백분위
            
            const vocabulary_score = generateRandomScore();
            const structure_score = generateRandomScore();
            const logic_score = generateRandomScore();
            const creativity_score = generateRandomScore();
            const overall_score = Math.floor((vocabulary_score + structure_score + logic_score + creativity_score) / 4);
            const percentile = generateRandomPercentile();
            
            const sampleResult = {
                vocabulary_score: vocabulary_score,
                structure_score: structure_score,
                logic_score: logic_score,
                creativity_score: creativity_score,
                overall_score: overall_score,
                strengths: ["구체적인 예시 사용", "논리적 전개", "적절한 어휘 선택"],
                improvements: ["문장 연결성 강화", "더 다양한 표현 사용"],
                detailed_analysis: `이 글은 주제에 대한 명확한 이해를 보여주며, 구체적인 예시를 활용하여 주장을 뒷받침하고 있습니다. 어휘력 ${vocabulary_score}점, 구조 ${structure_score}점, 논리 ${logic_score}점, 창의성 ${creativity_score}점으로 종합 ${overall_score}점을 기록했습니다. 특히 양면성을 균형 있게 제시한 점이 인상적입니다.`,
                percentile: percentile,
                rewritten_text: "디지털 시대의 익명성은 복합적인 특성을 지닌다. 긍정적 측면에서는 자유로운 의견 표현을 통해 민주주의 발전에 기여하지만, 부정적 측면에서는 무책임한 발언과 가짜뉴스 확산의 원인이 되기도 한다. 따라서 우리는 익명성의 이중성을 인식하고, 건전한 디지털 문화 조성을 위한 적극적인 노력이 필요하다."
            };
            
            console.log('🎲 랜덤 결과 생성:', {
                vocabulary: vocabulary_score,
                structure: structure_score,
                logic: logic_score,
                creativity: creativity_score,
                overall: overall_score,
                percentile: percentile
            });
            
            // 4. 모든 차트와 텍스트 업데이트
            console.log('🔄 모든 차트 업데이트 시작...');
            
            try {
                // 게이지 차트 업데이트
                if (typeof updateGaugeChart === 'function') {
                    updateGaugeChart(sampleResult.overall_score);
                    console.log('✅ 게이지 차트 업데이트 완료');
                } else {
                    console.log('❌ updateGaugeChart 함수를 찾을 수 없습니다');
                }
                
                // 백분위 차트 업데이트 (정규분포 곡선을 따라)
                if (typeof updatePercentileChart === 'function') {
                    updatePercentileChart(sampleResult.percentile);
                    console.log('✅ 백분위 차트 업데이트 완료');
                } else {
                    console.log('❌ updatePercentileChart 함수를 찾을 수 없습니다');
                }
                
                // 레이더 차트 업데이트
                if (typeof updateRadarChart === 'function') {
                    updateRadarChart([sampleResult.vocabulary_score, sampleResult.structure_score, sampleResult.logic_score, sampleResult.creativity_score]);
                    console.log('✅ 레이더 차트 업데이트 완료');
                } else {
                    console.log('❌ updateRadarChart 함수를 찾을 수 없습니다');
                }
                
                // 막대 차트 업데이트
                if (typeof updateBarChart === 'function') {
                    updateBarChart(sampleResult);
                    console.log('✅ 막대 차트 업데이트 완료');
                } else {
                    console.log('❌ updateBarChart 함수를 찾을 수 없습니다');
                }
                
                // 텍스트 요소 업데이트
                if (typeof updateTextElements === 'function') {
                    updateTextElements(sampleResult);
                    console.log('✅ 텍스트 요소 업데이트 완료');
                } else {
                    console.log('❌ updateTextElements 함수를 찾을 수 없습니다');
                }
                
                // 구조 및 논리성 섹션 업데이트
                if (typeof updateStructureAndLogicSection === 'function') {
                    updateStructureAndLogicSection(sampleResult);
                    console.log('✅ 구조 및 논리성 섹션 업데이트 완료');
                } else {
                    console.log('❌ updateStructureAndLogicSection 함수를 찾을 수 없습니다');
                }
                
                // 리라이팅 제안 업데이트
                if (typeof updateRewritingSuggestion === 'function') {
                    updateRewritingSuggestion(sampleResult);
                    console.log('✅ 리라이팅 제안 업데이트 완료');
                } else {
                    console.log('❌ updateRewritingSuggestion 함수를 찾을 수 없습니다');
                }
                
            } catch (error) {
                console.error('❌ 테스트 중 오류 발생:', error);
            }
            
            console.log('🎉 모든 테스트 완료! GPT 토큰 없이 모든 기능이 정상 작동합니다.');
        };
        
        console.log('Test function available: testWithSampleText()');
        
        // GPT 분석 함수
        window.analyzeWithGPT = async function() {
            console.log('GPT 분석 시작...');
            
            // API 설정 확인
            console.log('API_CONFIG:', window.API_CONFIG);
            console.log('analyzeText 함수:', typeof window.analyzeText);
            
            // 로딩 표시 (버튼이 없으므로 콘솔 로그로 대체)
            console.log('🤖 GPT 분석 시작...');
            
            try {
                // URL 파라미터에서 텍스트와 주제 가져오기
                const urlParams = new URLSearchParams(window.location.search);
                let text = urlParams.get('text');
                let topic = urlParams.get('topic');
                
                // URL 파라미터가 없으면 localStorage에서 가져오기
                if (!text || !topic) {
                    text = localStorage.getItem('analysis_text');
                    topic = localStorage.getItem('analysis_topic');
                }
                
                if (!text || !topic) {
                    alert('분석할 글이 없습니다. 글쓰기 페이지에서 글을 작성한 후 다시 시도해주세요.');
                    return;
                }
                
                // 디코딩
                if (text.includes('%')) {
                    text = decodeURIComponent(text);
                }
                if (topic.includes('%')) {
                    topic = decodeURIComponent(topic);
                }
                
                console.log('분석할 텍스트:', text);
                console.log('분석할 주제:', topic);
                
                // analyzeText 함수 존재 확인
                if (typeof analyzeText !== 'function') {
                    console.error('analyzeText 함수가 정의되지 않음');
                    alert('GPT 분석 함수를 찾을 수 없습니다. API 설정을 확인해주세요.');
                    return;
                }
                
                console.log('GPT API 호출 시작...');
                // GPT API 호출
                const result = await analyzeText(text, topic);
                
                if (result.error) {
                    console.error('GPT 분석 오류:', result.error);
                    alert('분석 중 오류가 발생했습니다: ' + result.error);
                    return;
                }
                
                console.log('GPT 분석 결과:', result);
                console.log('전체 응답 키들:', Object.keys(result));
                console.log('advanced_vocabulary 데이터:', result.advanced_vocabulary);
                console.log('advanced_vocabulary 타입:', typeof result.advanced_vocabulary);
                console.log('advanced_vocabulary 배열 여부:', Array.isArray(result.advanced_vocabulary));
                console.log('전체 응답 데이터:', JSON.stringify(result, null, 2));
                
                // 결과를 페이지에 표시
                updateAnalysisWithGPTResult(result);
                
            } catch (error) {
                console.error('GPT 분석 중 오류:', error);
                alert('분석 중 오류가 발생했습니다: ' + error.message);
            } finally {
                // 분석 완료
                console.log('GPT 분석 완료');
            }
        };
        
        // GPT 분석 결과를 페이지에 업데이트하는 함수
        function updateAnalysisWithGPTResult(result) {
            console.log('Updating charts with GPT result:', result);
            
            // 1. 원형 게이지 차트 업데이트
            updateGaugeChart(result.overall_score || result.vocabulary_score || 0);
            
            // 2. 백분위 차트 업데이트
            updatePercentileChart(result.percentile || 0);
            
            // 3. 레이더 차트 업데이트
            updateRadarChart(result);
            
            // 4. 막대 차트 업데이트
            updateBarChart(result);
            
            // 5. 텍스트 업데이트
            updateTextElements(result);
            
            // 6. 어휘 카드 업데이트
            updateVocabularyCards(result);
            
            // 7. 상세 분석 결과 추가 제거 (title-description에 추가하지 않음)
            
            alert('GPT 분석이 완료되었습니다!');
        }
        
        // 원형 게이지 차트 업데이트
        window.updateGaugeChart = function(score) {
            const gaugeProgress = document.querySelector('.gauge-progress');
            const gaugeNumber = document.querySelector('.gauge-number');
            
            if (gaugeProgress && gaugeNumber) {
                // 점수에 따른 원주 계산 (0-100을 0-502.4로 변환)
                const circumference = 502.4;
                const progress = (score / 100) * circumference;
                
                gaugeProgress.style.strokeDasharray = `${progress} ${circumference}`;
                gaugeNumber.textContent = score;
                
                console.log('Gauge chart updated:', score);
            } else {
                console.error('Gauge chart elements not found:', { gaugeProgress, gaugeNumber });
            }
        }
        
        // 백분위 차트 업데이트
        window.updatePercentileChart = function(percentile) {
            const percentileScore = document.querySelector('.percentile-score');
            const percentileList = document.querySelector('.percentile-list');
            
            console.log('Updating percentile chart:', percentile);
            console.log('Elements found:', { percentileScore, percentileList });
            
            if (percentileScore) {
                percentileScore.textContent = `상위 ${100 - percentile}%`;
            }
            
            // 원래 백분위 차트 로직 사용 (정규분포 곡선을 따라가면서)
            if (window.updateScore && typeof percentile === 'number' && percentile >= 0 && percentile <= 100) {
                // percentile은 상위 몇 %이므로, 0-100 점수로 변환
                // 예: 상위 40% = 60점
                const scorePercent = 100 - percentile;
                window.updateScore(scorePercent);
            } else {
                console.log('updateScore function not available, using fallback');
                // Fallback: 단순 위치 설정
                const animatedRedDot = document.getElementById('animatedRedDot');
                if (animatedRedDot) {
                    animatedRedDot.style.left = `${percentile}%`;
                    animatedRedDot.style.top = '50%';
                    animatedRedDot.style.opacity = '1';
                }
            }
            
            // percentile-list 문장들 업데이트
            if (percentileList) {
                let percentileDescription = '';
                let percentileDetails = '';
                
                if (percentile >= 90) {
                    percentileDescription = '상위 10%';
                    percentileDetails = '전문가 수준의 글쓰기 실력을 보여줍니다. 문학적 표현과 깊이 있는 사고가 돋보입니다.';
                } else if (percentile >= 80) {
                    percentileDescription = '상위 20%';
                    percentileDetails = '대졸 이상, 혹은 독서량이 많은 성인군에서 흔히 볼 수 있는 수준입니다. 주제에 대한 통찰과 고급 어휘 사용이 돋보입니다.';
                } else if (percentile >= 70) {
                    percentileDescription = '상위 30%';
                    percentileDetails = '일반적인 대학생 수준의 글쓰기 실력입니다. 논리적 구성과 적절한 어휘 사용이 잘 드러납니다.';
                } else if (percentile >= 60) {
                    percentileDescription = '상위 40%';
                    percentileDetails = '고등학생 상위권 수준의 글쓰기 실력입니다. 기본적인 문장 구성과 표현력이 양호합니다.';
                } else if (percentile >= 50) {
                    percentileDescription = '상위 50%';
                    percentileDetails = '평균적인 글쓰기 실력입니다. 더 많은 연습과 독서를 통해 실력을 향상시킬 수 있습니다.';
                } else if (percentile >= 40) {
                    percentileDescription = '상위 60%';
                    percentileDetails = '기본적인 글쓰기 능력을 갖추고 있습니다. 문장 구조와 어휘 사용에 더 신경 쓸 필요가 있습니다.';
                } else if (percentile >= 30) {
                    percentileDescription = '상위 70%';
                    percentileDetails = '글쓰기 기초를 다지는 단계입니다. 꾸준한 연습을 통해 실력을 향상시킬 수 있습니다.';
                } else if (percentile >= 20) {
                    percentileDescription = '상위 80%';
                    percentileDetails = '글쓰기 학습이 필요한 단계입니다. 기본 문법과 어휘 학습에 집중하세요.';
                } else {
                    percentileDescription = '상위 90%';
                    percentileDetails = '글쓰기 기초부터 차근차근 학습이 필요한 단계입니다. 기초 문법과 어휘력 향상에 집중하세요.';
                }
                
                percentileList.innerHTML = `
                    <li>${percentileDetails}</li>
                    <li>${percentileDescription} 수준의 글쓰기 실력을 보여줍니다.</li>
                `;
            }
            
            console.log('Percentile chart updated:', percentile);
        }
        
        // 레이더 차트 업데이트
        window.updateRadarChart = function(result) {
            const dataBars = document.querySelectorAll('.data-bar');
            const legendScores = document.querySelectorAll('.legend-score');
            
            const scores = [
                result.vocabulary_score || 0,
                result.structure_score || 0,
                result.logic_score || 0,
                result.creativity_score || 0
            ];
            
            dataBars.forEach((bar, index) => {
                if (scores[index] !== undefined) {
                    // 점수를 높이로 변환 (0-100을 0-60px로 변환)
                    const height = (scores[index] / 100) * 60;
                    bar.style.height = `${height}px`;
                    // 색상은 변경하지 않음 (기존 CSS 색상 유지)
                }
            });
            
            legendScores.forEach((score, index) => {
                if (scores[index] !== undefined) {
                    score.textContent = `${scores[index]}/100`;
                }
            });
            
            console.log('Radar chart updated:', scores);
        }
        
        // 막대 차트 업데이트 (점수에 따른 어휘 수준 분포)
        window.updateBarChart = function(result) {
            const barSegments = document.querySelectorAll('.bar-segment');
            const labelPercentages = document.querySelectorAll('.label-percentage');
            
            console.log('Updating bar chart:', result);
            console.log('Bar elements found:', { barSegments: barSegments.length, labelPercentages: labelPercentages.length });
            
            // 점수에 따른 어휘 수준 분포 계산
            const overallScore = result.overall_score || 0;
            let distribution;
            
            if (overallScore >= 90) {
                distribution = [40, 35, 20, 5]; // A등급, B등급, C등급, 외래어
            } else if (overallScore >= 80) {
                distribution = [30, 40, 25, 5];
            } else if (overallScore >= 70) {
                distribution = [20, 45, 30, 5];
            } else if (overallScore >= 60) {
                distribution = [10, 35, 45, 10];
            } else {
                distribution = [5, 25, 50, 20];
            }
            
            barSegments.forEach((segment, index) => {
                if (distribution[index] !== undefined) {
                    segment.setAttribute('data-percentage', distribution[index]);
                    console.log(`Bar segment ${index} updated to ${distribution[index]}%`);
                }
            });
            
            labelPercentages.forEach((percentage, index) => {
                if (distribution[index] !== undefined) {
                    percentage.textContent = `${distribution[index]}%`;
                }
            });
            
            console.log('Bar chart updated:', distribution);
        }
        
        // 텍스트 요소들 업데이트
        window.updateTextElements = function(result) {
            const scoreHighlight = document.querySelector('.score-highlight');
            const scoreDescription = document.querySelector('.score-description');
            
            if (scoreHighlight) {
                const overallScore = result.overall_score || 0;
                let level = '';
                
                if (overallScore >= 90) level = '글쓰기 마스터';
                else if (overallScore >= 80) level = '설득 장인';
                else if (overallScore >= 70) level = '표현의 달인';
                else if (overallScore >= 60) level = '성장하는 작가';
                else level = '열정적인 초보';
                
                scoreHighlight.textContent = level + '/';
            }
            
            if (scoreDescription) {
                if (result.detailed_analysis) {
                    // 100자 이내에서 문장이 완성되도록 처리
                    let text = result.detailed_analysis;
                    if (text.length > 100) {
                        // 100자 지점에서 가장 가까운 문장 끝 찾기
                        let cutPoint = 100;
                        for (let i = 100; i >= 70; i--) { // 70자부터 100자까지 역순으로 검색
                            if (text[i] === '.' || text[i] === '!' || text[i] === '?' || text[i] === '다' || text[i] === '요') {
                                // 한국어 문장 끝 패턴 확인
                                if (text[i] === '다' || text[i] === '요') {
                                    // '다'나 '요' 다음에 공백이나 문장부호가 있는지 확인
                                    if (i + 1 >= text.length || text[i + 1] === ' ' || text[i + 1] === '.' || text[i + 1] === '!' || text[i + 1] === '?') {
                                        cutPoint = i + 1;
                                        break;
                                    }
                                } else {
                                    cutPoint = i + 1;
                                    break;
                                }
                            }
                        }
                        text = text.substring(0, cutPoint).trim();
                    }
                    scoreDescription.textContent = text;
                } else {
                    scoreDescription.textContent = 'GPT가 분석한 결과입니다.';
                }
            }
            
            // 문장 구조 및 논리성 섹션 업데이트
            updateStructureAndLogicSection(result);
        }
        
        // 문장 구조 및 논리성 섹션 업데이트
        window.updateStructureAndLogicSection = function(result) {
            const structureText = document.querySelector('.structure-text');
            const structureNote = document.querySelector('.structure-note');
            
            if (structureText) {
                // GPT에서 제공된 structure_analysis 우선 사용
                if (result.structure_analysis && Array.isArray(result.structure_analysis)) {
                    structureText.textContent = result.structure_analysis.join(' ');
                    console.log('Updated structure text with GPT analysis:', result.structure_analysis);
                } else {
                    // GPT 데이터가 없는 경우 기본 분석 사용
                    const structureScore = result.structure_score || 0;
                    const logicScore = result.logic_score || 0;
                    const vocabularyScore = result.vocabulary_score || 0;
                    const creativityScore = result.creativity_score || 0;
                    
                    let structureItems = [];
                
                // 구조 점수에 따른 피드백
                if (structureScore >= 80) {
                    structureItems.push('복잡한 주제를 명확하고 논리적으로 전개하는 능력이 뛰어납니다.');
                } else if (structureScore >= 60) {
                    structureItems.push('주제를 체계적으로 구성하고 전개하는 능력이 양호합니다.');
                } else {
                    structureItems.push('문장 구조를 더욱 체계적으로 개선할 여지가 있습니다.');
                }
                
                // 어휘 점수에 따른 피드백
                if (vocabularyScore >= 80) {
                    structureItems.push('고급 어휘를 적절한 맥락에 배치하여 의미를 명확하게 전달합니다.');
                } else if (vocabularyScore >= 60) {
                    structureItems.push('적절한 어휘 선택으로 의미 전달이 명확합니다.');
                } else {
                    structureItems.push('어휘 선택의 다양성과 정확성을 높일 필요가 있습니다.');
                }
                
                // 논리 점수에 따른 피드백
                if (logicScore >= 80) {
                    structureItems.push('문장 간의 연결성이 자연스럽게 유지되어 전체적인 흐름이 매끄럽습니다.');
                } else if (logicScore >= 60) {
                    structureItems.push('논리적 전개가 대체로 잘 이루어지고 있습니다.');
                } else {
                    structureItems.push('논리적 연결성을 강화하여 글의 흐름을 개선할 수 있습니다.');
                }
                
                // 창의성 점수에 따른 피드백
                if (creativityScore >= 80) {
                    structureItems.push('추상적 개념을 구체적인 예시와 함께 설명하여 이해도를 높입니다.');
                } else if (creativityScore >= 60) {
                    structureItems.push('적절한 예시와 설명으로 내용을 효과적으로 전달합니다.');
                } else {
                    structureItems.push('구체적인 예시와 설명을 추가하여 내용을 더욱 풍부하게 만들 수 있습니다.');
                }
                
                // GPT의 강점과 개선점을 활용한 추가 피드백
                if (result.strengths && result.strengths.length > 0) {
                    const strength = result.strengths[0]; // 첫 번째 강점 사용
                    structureItems.push(`특히 "${strength}" 부분에서 뛰어난 능력을 보여줍니다.`);
                }
                
                if (result.improvements && result.improvements.length > 0) {
                    const improvement = result.improvements[0]; // 첫 번째 개선점 사용
                    structureItems.push(`"${improvement}" 영역에서 더욱 발전할 수 있습니다.`);
                }
                
                    // 텍스트 생성
                    structureText.textContent = structureItems.join(' ');
                }
            }
            
            // 구조 노트 업데이트
            if (structureNote) {
                const overallScore = result.overall_score || 0;
                let note = '';
                
                if (overallScore >= 90) {
                    note = '전문가 수준의 글쓰기 실력을 보여주시네요!';
                } else if (overallScore >= 80) {
                    note = '자신의 생각을 우수하게 표현하시네요!';
                } else if (overallScore >= 70) {
                    note = '잘 구성된 글을 작성하셨습니다!';
                } else if (overallScore >= 60) {
                    note = '기본적인 글쓰기 능력을 잘 보여주셨습니다!';
                } else {
                    note = '꾸준한 연습을 통해 더욱 발전할 수 있습니다!';
                }
                
                structureNote.textContent = note;
            }
        }
        
        // 상세 분석 결과 추가
        function addDetailedAnalysis(result) {
            const titleDesc = document.querySelector('.title-description');
            if (titleDesc) {
                const existingContent = titleDesc.innerHTML;
                titleDesc.innerHTML = existingContent + `
                    <div class="gpt-analysis" style="margin-top: 2rem; padding: 1.5rem; background: #1a1a1a; border: 1px solid #10A37F; border-radius: 12px;">
                        <h3 style="color: #10A37F; margin-bottom: 1rem;">🤖 GPT 분석 결과</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                            <div class="score-item">
                                <strong>어휘 표현력:</strong> ${result.vocabulary_score || 0}/100
                            </div>
                            <div class="score-item">
                                <strong>문장 구성:</strong> ${result.structure_score || 0}/100
                            </div>
                            <div class="score-item">
                                <strong>논리적 전개:</strong> ${result.logic_score || 0}/100
                            </div>
                            <div class="score-item">
                                <strong>창의성:</strong> ${result.creativity_score || 0}/100
                            </div>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <strong>강점:</strong><br>
                            ${(result.strengths || []).map(strength => `• ${strength}`).join('<br>')}
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <strong>개선점:</strong><br>
                            ${(result.improvements || []).map(improvement => `• ${improvement}`).join('<br>')}
                        </div>
                        <div>
                            <strong>상세 분석:</strong><br>
                            ${result.detailed_analysis || '상세 분석을 제공할 수 없습니다.'}
                        </div>
                    </div>
                `;
            }
            
        // 리라이팅 제안 섹션 업데이트
        updateRewritingSuggestion(result);
    }
    
    // 어휘 카드 업데이트 함수
    window.updateVocabularyCards = function(result) {
        console.log('Updating vocabulary cards with GPT result:', result);
        console.log('result.advanced_vocabulary:', result.advanced_vocabulary);
        console.log('vocabCards found:', document.querySelectorAll('.vocab-card').length);
        
        const vocabCards = document.querySelectorAll('.vocab-card');
        
        // 모든 카드를 먼저 숨김
        vocabCards.forEach(card => {
            card.style.display = 'none';
        });
        
        // advanced_vocabulary가 없으면 다른 필드에서 어휘 정보 추출 시도
        let vocabularyData = result.advanced_vocabulary;
        
        if (!vocabularyData && result.detailed_analysis) {
            // detailed_analysis에서 어휘 정보 추출 시도
            console.log('advanced_vocabulary가 없어서 detailed_analysis에서 어휘 추출 시도');
            vocabularyData = await extractVocabularyFromAnalysis(result.detailed_analysis);
        }
        
        if (!vocabularyData && result.strengths) {
            // strengths에서 어휘 정보 추출 시도
            console.log('detailed_analysis에서도 어휘를 찾지 못해 strengths에서 추출 시도');
            vocabularyData = await extractVocabularyFromStrengths(result.strengths);
        }
        
        if (vocabularyData && Array.isArray(vocabularyData)) {
            const vocabCount = vocabularyData.length;
            
            // 추출된 어휘로 카드 업데이트
            vocabularyData.forEach((vocab, index) => {
                if (vocabCards[index]) {
                    const card = vocabCards[index];
                    const wordElement = card.querySelector('.card-word');
                    const posElement = card.querySelector('.card-pos');
                    const descElement = card.querySelector('.card-desc');
                    
                    if (wordElement) wordElement.textContent = vocab.word;
                    if (posElement) posElement.textContent = vocab.pos;
                    if (descElement) descElement.textContent = vocab.definition;
                    
                    // 카드 표시
                    card.style.display = 'block';
                    
                    console.log(`Updated card ${index + 1}: ${vocab.word} (${vocab.pos})`);
                }
            });
            
            // 5개 이상인 경우 가로 스크롤 활성화
            if (vocabCount >= 5) {
                const cardsContainer = document.querySelector('.vocabulary-cards');
                if (cardsContainer) {
                    cardsContainer.style.overflowX = 'auto';
                    console.log(`Enabled horizontal scroll for ${vocabCount} cards`);
                }
            } else {
                // 5개 미만인 경우 가로 스크롤 비활성화
                const cardsContainer = document.querySelector('.vocabulary-cards');
                if (cardsContainer) {
                    cardsContainer.style.overflowX = 'hidden';
                    console.log(`Disabled horizontal scroll for ${vocabCount} cards`);
                }
            }
        } else {
            console.log('No advanced vocabulary data found, hiding all cards');
            console.log('GPT did not return advanced_vocabulary data. Cards will remain hidden.');
            
            // GPT 데이터가 없으면 모든 카드 숨김
            vocabCards.forEach(card => {
                card.style.display = 'none';
            });
        }
    }
    
    // 제공된 원본 텍스트에서 어휘 추출하는 함수
    async function extractVocabularyFromOriginalText(originalText) {
        console.log('extractVocabularyFromOriginalText called with:', originalText);
        
        if (!originalText) return null;
        
        // 한국어 어휘 추출 (조사, 어미 제거)
        const words = extractKoreanWords(originalText);
        console.log('추출된 단어들:', words);
        
        // 상위 수준의 어휘만 선택 (길이와 복잡성 기준)
        const advancedWords = selectAdvancedWords(words);
        console.log('선택된 고급 어휘들:', advancedWords);
        
        // 각 어휘의 품사와 정의 분석 (GPT에게 질문)
        return await analyzeWordsWithGPT(advancedWords);
    }
    
    // 한국어 단어 추출 (조사, 어미 제거)
    function extractKoreanWords(text) {
        // 조사 패턴
        const particles = ['은', '는', '이', '가', '을', '를', '에', '에서', '로', '으로', '와', '과', '의', '도', '만', '까지', '부터', '처럼', '같이', '보다', '에게', '한테', '께'];
        
        // 활용된 어미 패턴 (기본형이 아닌 활용형만)
        const conjugatedEndings = ['는', '은', '을', '를', '에', '에서', '로', '으로', '와', '과', '의', '도', '만', '까지', '부터', '처럼', '같이', '보다', '에게', '한테', '께', '고', '며', '면서', '하니', '해서', '하면', '하지만', '하므로', '하므로서', '하므로써'];
        
        // 2글자 이상의 한국어 단어 추출
        const words = text.match(/[가-힣]{2,}/g) || [];
        
        // 조사와 활용된 어미 제거하여 기본형 추출
        const cleanWords = words.map(word => {
            let cleanWord = word;
            
            // 조사 제거
            for (const particle of particles) {
                if (cleanWord.endsWith(particle)) {
                    cleanWord = cleanWord.slice(0, -particle.length);
                    break;
                }
            }
            
            // 활용된 어미 제거 (기본형이 아닌 활용형만)
            for (const ending of conjugatedEndings) {
                if (cleanWord.endsWith(ending)) {
                    cleanWord = cleanWord.slice(0, -ending.length);
                    break;
                }
            }
            
            // "~하다"로 끝나는 경우 기본형으로 복원
            if (cleanWord.endsWith('하') && !cleanWord.endsWith('하다')) {
                cleanWord = cleanWord + '다';
            }
            
            return cleanWord;
        }).filter(word => word.length >= 2); // 2글자 이상만 유지
        
        // 중복 제거
        return [...new Set(cleanWords)];
    }
    
    // 고급 어휘 선택 (길이와 복잡성 기준)
    function selectAdvancedWords(words) {
        // 길이순으로 정렬하고 상위 5개 선택
        return words
            .sort((a, b) => b.length - a.length)
            .slice(0, 5);
    }
    
    // GPT에게 단어 분석 요청
    async function analyzeWordsWithGPT(words) {
        console.log('GPT에게 단어 분석 요청:', words);
        
        try {
            // 단어들을 쉼표로 구분하여 문자열로 만들기
            const wordList = words.join(', ');
            
            // GPT에게 단어 분석 요청
            const response = await fetch('https://mundeuk-five.vercel.app/api/analyze', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    text: `다음 한국어 단어들의 품사와 정의를 분석해주세요: ${wordList}`,
                    topic: "단어 분석"
                })
            });
            
            if (!response.ok) {
                throw new Error(`API 요청 실패: ${response.status}`);
            }
            
            const data = await response.json();
            console.log('GPT 단어 분석 결과:', data);
            
            // GPT 응답에서 단어 정보 추출 (간단한 파싱)
            return parseWordAnalysisFromGPT(data, words);
            
        } catch (error) {
            console.error('GPT 단어 분석 오류:', error);
            // 오류 시 기본 분석 사용
            return words.map(word => analyzeWordBasic(word));
        }
    }
    
    // GPT 응답에서 단어 분석 정보 파싱
    function parseWordAnalysisFromGPT(gptResponse, words) {
        // GPT 응답에서 단어 정보를 추출하는 로직
        // 실제로는 GPT가 구조화된 응답을 반환하도록 프롬프트를 수정해야 함
        
        // 임시로 기본 분석 사용
        return words.map(word => analyzeWordBasic(word));
    }
    
    // 기본 단어 분석 (GPT 실패 시 사용)
    function analyzeWordBasic(word) {
        // 간단한 품사 분석
        let pos = "명사";
        let definition = "";
        
        // 동사 패턴
        if (word.endsWith('하다') || word.endsWith('되다')) {
            pos = "동사";
        }
        // 형용사 패턴
        else if (word.endsWith('적') || word.endsWith('스러운') || word.endsWith('한')) {
            pos = "형용사";
        }
        // 부사 패턴
        else if (word.endsWith('게') || word.endsWith('히') || word.endsWith('이')) {
            pos = "부사";
        }
        
        // 기본 정의 생성
        definition = generateDefinition(word, pos);
        
        return {
            word: word,
            pos: pos,
            definition: definition
        };
    }
    
    // 정의 생성
    function generateDefinition(word, pos) {
        const definitions = {
            "디지털": "컴퓨터나 전자 기술을 이용한 방식의",
            "시대": "특정한 특징을 가진 역사적 기간",
            "익명성": "이름이나 신원을 알 수 없는 상태",
            "양면성": "서로 다른 두 가지 특성을 동시에 지니는 성질",
            "민주주의": "국민이 주권을 가지고 스스로를 통치하는 정치 체제",
            "조장": "어떤 일이 일어나도록 부추기거나 도움을 주는 것",
            "진정성": "진실하고 정직한 성질",
            "표현": "생각이나 감정을 나타내는 것",
            "전개": "내용을 펼쳐 나가는 것",
            "구성": "여러 요소를 체계적으로 배열하는 것",
            "연결성": "서로 연결되어 있는 성질",
            "흐름": "일정한 방향으로 진행되는 것",
            "개념": "사물이나 현상에 대한 추상적 인식",
            "예시": "설명을 위해 들어주는 구체적인 사례",
            "이해도": "이해하는 정도",
            "발전": "더 나은 상태로 나아가는 것",
            "강화": "더욱 강하게 만드는 것",
            "문화": "한 사회의 생활 양식과 가치관",
            "노력": "목표를 달성하기 위해 애쓰는 것",
            "사용": "어떤 목적을 위해 활용하는 것",
            "가능": "할 수 있는 상태",
            "자유로운": "제약이 없는 상태의",
            "의견": "개인의 생각이나 판단",
            "기여": "어떤 일에 도움이 되는 것",
            "책임감": "자신의 행동에 대한 책임을 지는 마음",
            "발언": "말로 표현하는 것",
            "가짜뉴스": "거짓 정보를 담은 뉴스",
            "확산": "넓은 범위로 퍼져나가는 것",
            "맥락": "말이나 글의 앞뒤 상황",
            "장단점": "좋은 점과 나쁜 점",
            "균형": "서로 맞추어 조화를 이루는 것",
            "건전한": "건강하고 바른 상태의",
            "온라인": "인터넷을 통한",
            "조성": "어떤 분위기나 환경을 만드는 것",
            "필요": "반드시 있어야 하는 것",
            "사회": "사람들이 모여 살아가는 공동체",
            "기술": "과학적 지식을 실용적으로 활용하는 방법",
            "정보": "알아야 할 내용이나 자료",
            "소통": "서로 의견을 주고받는 것",
            "참여": "어떤 활동에 함께하는 것",
            "협력": "함께 일하는 것",
            "창의": "새롭고 독창적인 생각",
            "혁신": "새로운 방법으로 개선하는 것",
            "변화": "이전과 달라지는 것",
            "미래": "앞으로 올 시간",
            "현재": "지금 이 순간",
            "과거": "이미 지나간 시간",
            "경험": "직접 겪어본 일",
            "학습": "새로운 것을 배우는 것",
            "성장": "발전하여 커지는 것",
            "목표": "달성하려는 목적",
            "계획": "앞으로 할 일을 미리 정하는 것",
            "실행": "계획을 실제로 행하는 것",
            "결과": "어떤 행동의 끝",
            "효과": "어떤 행동이 가져오는 영향",
            "영향": "다른 것에 미치는 작용",
            "작용": "어떤 효과를 나타내는 것",
            "원인": "어떤 결과를 가져오는 근본적인 이유",
            "결과": "어떤 원인으로 인해 생기는 것",
            "관계": "서로 연결되어 있는 상태",
            "연결": "서로 이어주는 것",
            "상호": "서로 간의",
            "의존": "다른 것에 의지하는 것",
            "독립": "다른 것에 의지하지 않는 것",
            "자율": "스스로 판단하여 행동하는 것",
            "통제": "다른 것을 관리하는 것",
            "관리": "체계적으로 다루는 것",
            "조직": "체계적으로 구성된 집단",
            "구조": "여러 부분이 체계적으로 배열된 형태",
            "체계": "일정한 원리에 따라 정리된 조직",
            "원리": "사물의 근본적인 법칙",
            "법칙": "변하지 않는 규칙",
            "규칙": "지켜야 할 기준",
            "기준": "판단의 근거가 되는 것",
            "근거": "주장을 뒷받침하는 자료",
            "자료": "연구나 조사에 필요한 정보",
            "조사": "자세히 알아보는 것",
            "연구": "체계적으로 탐구하는 것",
            "탐구": "진리를 찾아가는 것",
            "진리": "변하지 않는 참된 이치",
            "이치": "사물의 도리",
            "도리": "마땅히 지켜야 할 바른 길",
            "윤리": "사람이 지켜야 할 도덕적 기준",
            "도덕": "사람이 지켜야 할 바른 행동 기준",
            "가치": "중요하게 여기는 것",
            "의미": "내포하고 있는 뜻",
            "목적": "달성하려는 목표",
            "의도": "마음속에 품은 목적",
            "동기": "행동을 일으키는 원인",
            "욕구": "충족하고 싶어하는 마음",
            "욕망": "갖고 싶어하는 마음",
            "희망": "이루고 싶어하는 마음",
            "꿈": "이루고 싶은 이상",
            "이상": "추구하는 완벽한 상태",
            "현실": "실제로 존재하는 상태",
            "실제": "정말로 존재하는 것",
            "가상": "실제가 아닌 상상의",
            "상상": "마음속으로 그려보는 것",
            "창조": "새로운 것을 만들어내는 것",
            "제작": "어떤 것을 만드는 것",
            "생산": "재화나 서비스를 만들어내는 것",
            "제공": "필요한 것을 주는 것",
            "서비스": "다른 사람을 위해 하는 일",
            "도움": "어려움을 해결해주는 것",
            "지원": "도와주는 것",
            "협조": "함께 일하는 것",
            "협의": "함께 의논하는 것",
            "토론": "의견을 주고받는 것",
            "논의": "함께 의논하는 것",
            "의논": "함께 상의하는 것",
            "상의": "함께 의견을 나누는 것",
            "대화": "서로 말을 주고받는 것",
            "소통": "서로 의견을 주고받는 것",
            "교류": "서로 주고받는 것",
            "교환": "서로 바꾸는 것",
            "변화": "이전과 달라지는 것",
            "발전": "더 나은 상태로 나아가는 것",
            "진보": "앞으로 나아가는 것",
            "퇴보": "뒤로 물러나는 것",
            "정체": "발전하지 않고 머물러 있는 것",
            "안정": "변화 없이 고정된 상태",
            "불안정": "변화가 많아 불안한 상태",
            "안전": "위험이 없는 상태",
            "위험": "해로울 수 있는 상태",
            "안전": "위험이 없는 상태",
            "보호": "위험으로부터 지키는 것",
            "방어": "공격을 막는 것",
            "공격": "다른 것을 해치는 행동",
            "해치": "다른 것을 손상시키는 것",
            "손상": "상처를 입는 것",
            "상처": "아픈 부위",
            "치료": "병을 고치는 것",
            "회복": "원래 상태로 돌아가는 것",
            "개선": "더 좋게 만드는 것",
            "향상": "수준이 높아지는 것",
            "증가": "양이 많아지는 것",
            "감소": "양이 적어지는 것",
            "확대": "범위가 넓어지는 것",
            "축소": "범위가 좁아지는 것",
            "확장": "범위가 넓어지는 것",
            "수축": "범위가 좁아지는 것",
            "성장": "크기가 커지는 것",
            "감소": "크기가 작아지는 것",
            "발달": "기능이 향상되는 것",
            "퇴화": "기능이 약해지는 것",
            "진화": "더 나은 형태로 변하는 것",
            "변화": "형태나 성질이 달라지는 것",
            "전환": "다른 방향으로 바뀌는 것",
            "변환": "다른 형태로 바뀌는 것",
            "변형": "형태가 바뀌는 것",
            "수정": "잘못된 부분을 고치는 것",
            "보정": "틀린 부분을 바로잡는 것",
            "조정": "적절하게 맞추는 것",
            "조절": "적당하게 조정하는 것",
            "통제": "다른 것을 관리하는 것",
            "관리": "체계적으로 다루는 것",
            "운영": "체계적으로 관리하는 것",
            "경영": "사업을 관리하는 것",
            "경제": "재화와 서비스의 생산과 소비 활동",
            "사회": "사람들이 모여 살아가는 공동체",
            "정치": "국가를 다스리는 일",
            "문화": "한 사회의 생활 양식과 가치관",
            "교육": "지식과 기술을 가르치는 것",
            "학습": "새로운 것을 배우는 것",
            "연구": "체계적으로 탐구하는 것",
            "개발": "새로운 것을 만들어내는 것",
            "혁신": "새로운 방법으로 개선하는 것",
            "창조": "새로운 것을 만들어내는 것",
            "발명": "새로운 것을 처음으로 만드는 것",
            "발견": "새로운 것을 찾아내는 것",
            "탐험": "알려지지 않은 곳을 찾아가는 것",
            "모험": "위험을 무릅쓰고 도전하는 것",
            "도전": "어려운 일에 맞서는 것",
            "시도": "어떤 일을 해보는 것",
            "실험": "가설을 검증하는 것",
            "검증": "참과 거짓을 확인하는 것",
            "확인": "정말인지 알아보는 것",
            "검사": "자세히 살펴보는 것",
            "분석": "구성 요소를 나누어 살펴보는 것",
            "종합": "여러 요소를 하나로 합치는 것",
            "통합": "여러 것을 하나로 합치는 것",
            "분리": "하나를 여러 개로 나누는 것",
            "구분": "서로 다르게 나누는 것",
            "차이": "서로 다른 점",
            "유사": "비슷한 점",
            "동일": "완전히 같은 것",
            "일치": "완전히 같은 것",
            "대조": "서로 비교하는 것",
            "비교": "서로 대조하는 것",
            "대비": "서로 대조하는 것",
            "상대": "다른 것과의 관계에서 보는 것",
            "절대": "다른 것과 관계없이 보는 것",
            "객관": "감정에 치우치지 않고 보는 것",
            "주관": "개인의 감정이나 의견에 따라 보는 것",
            "공정": "공평하고 정당한 것",
            "불공정": "공평하지 않은 것",
            "공평": "어느 쪽에도 치우치지 않은 것",
            "정당": "올바른 것",
            "부당": "올바르지 않은 것",
            "올바른": "정당하고 바른 것",
            "바른": "정당하고 올바른 것",
            "그른": "잘못된 것",
            "잘못": "틀린 것",
            "틀림": "잘못된 것",
            "맞음": "올바른 것",
            "정확": "틀림없는 것",
            "부정확": "틀린 것",
            "명확": "뚜렷한 것",
            "모호": "뚜렷하지 않은 것",
            "뚜렷": "명확한 것",
            "애매": "명확하지 않은 것",
            "분명": "명확한 것",
            "불분명": "명확하지 않은 것",
            "확실": "의심할 여지가 없는 것",
            "불확실": "의심스러운 것",
            "의심": "확신하지 못하는 마음",
            "확신": "틀림없다고 믿는 마음",
            "믿음": "확신하는 마음",
            "불신": "믿지 않는 마음",
            "신뢰": "믿고 의지하는 것",
            "의존": "다른 것에 의지하는 것",
            "독립": "다른 것에 의지하지 않는 것",
            "자립": "스스로 살아가는 것",
            "자율": "스스로 판단하여 행동하는 것",
            "자유": "제약이 없는 상태",
            "제약": "자유를 제한하는 것",
            "제한": "범위를 한정하는 것",
            "한정": "범위를 제한하는 것",
            "무제한": "제한이 없는 것",
            "제한적": "제한이 있는 것",
            "제한적": "제한이 있는 것",
            "무제한": "제한이 없는 것",
            "무한": "끝이 없는 것",
            "유한": "끝이 있는 것",
            "영원": "끝이 없는 시간",
            "일시": "잠깐의 시간",
            "영구": "영원히 지속되는 것",
            "임시": "잠깐 동안의 것",
            "상시": "항상 지속되는 것",
            "항상": "언제나",
            "때때로": "가끔",
            "가끔": "때때로",
            "자주": "많이",
            "가끔": "때때로",
            "항상": "언제나",
            "절대": "결코",
            "결코": "절대",
            "전혀": "조금도",
            "조금도": "전혀",
            "완전": "모든 면에서",
            "부분": "일부",
            "전체": "모든 부분",
            "일부": "전체의 일부분",
            "대부분": "전체의 많은 부분",
            "소수": "적은 수",
            "다수": "많은 수",
            "모든": "전체의",
            "어떤": "정해지지 않은",
            "특정": "정해진",
            "일반": "보통의",
            "특별": "보통과 다른",
            "보통": "일반적인",
            "평범": "특별하지 않은",
            "특이": "특별한",
            "독특": "특별한",
            "유일": "오직 하나뿐인",
            "단일": "하나의",
            "복수": "여러 개의",
            "다양": "여러 가지의",
            "다종": "여러 종류의",
            "단일": "하나의",
            "통일": "하나로 합치는 것",
            "분열": "여러 개로 나누는 것",
            "결합": "하나로 합치는 것",
            "분리": "여러 개로 나누는 것",
            "연결": "서로 이어주는 것",
            "단절": "연결을 끊는 것",
            "연속": "끊어지지 않고 계속되는 것",
            "중단": "중간에 끊는 것",
            "계속": "끊어지지 않고 이어지는 것",
            "중지": "중간에 멈추는 것",
            "시작": "처음으로 하는 것",
            "종료": "끝내는 것",
            "완료": "끝까지 마치는 것",
            "미완료": "끝까지 마치지 못한 것",
            "진행": "앞으로 나아가는 것",
            "정지": "멈추는 것",
            "운동": "움직이는 것",
            "정적": "움직이지 않는 것",
            "동적": "움직이는 것",
            "활동": "적극적으로 움직이는 것",
            "수동": "다른 것에 의해 움직이는 것",
            "능동": "스스로 움직이는 것",
            "적극": "능동적인",
            "소극": "수동적인",
            "긍정": "좋다고 생각하는 것",
            "부정": "좋지 않다고 생각하는 것",
            "긍정적": "좋은 방향의",
            "부정적": "좋지 않은 방향의",
            "낙관": "좋게 생각하는 것",
            "비관": "나쁘게 생각하는 것",
            "낙관적": "좋게 생각하는",
            "비관적": "나쁘게 생각하는",
            "희망": "좋은 결과를 기대하는 마음",
            "절망": "좋은 결과를 기대하지 않는 마음",
            "기대": "좋은 결과를 바라는 마음",
            "실망": "기대했던 것이 이루어지지 않아서 낙심하는 마음",
            "만족": "충분하다고 느끼는 마음",
            "불만": "충분하지 않다고 느끼는 마음",
            "만족스러운": "충분하다고 느끼는",
            "불만스러운": "충분하지 않다고 느끼는",
            "충분": "부족하지 않은",
            "부족": "충분하지 않은",
            "과다": "너무 많은",
            "과소": "너무 적은",
            "적절": "알맞은",
            "부적절": "알맞지 않은",
            "적당": "알맞은",
            "부적당": "알맞지 않은",
            "합당": "마땅한",
            "부합당": "마땅하지 않은",
            "당연": "마땅한",
            "부당연": "마땅하지 않은",
            "자연": "인위적이지 않은",
            "인위": "인간이 만든",
            "인공": "인간이 만든",
            "자연적": "인위적이지 않은",
            "인위적": "인간이 만든",
            "인공적": "인간이 만든",
            "실제": "정말로 존재하는",
            "가상": "실제가 아닌",
            "현실": "실제로 존재하는 상태",
            "이상": "추구하는 완벽한 상태",
            "현실적": "실제로 가능한",
            "이상적": "완벽한",
            "실용": "실제로 쓸모있는",
            "이론": "추상적인 지식",
            "실용적": "실제로 쓸모있는",
            "이론적": "추상적인",
            "구체": "명확하고 뚜렷한",
            "추상": "구체적이지 않은",
            "구체적": "명확하고 뚜렷한",
            "추상적": "구체적이지 않은",
            "명확": "뚜렷한",
            "모호": "뚜렷하지 않은",
            "명확한": "뚜렷한",
            "모호한": "뚜렷하지 않은",
            "뚜렷": "명확한",
            "애매": "명확하지 않은",
            "뚜렷한": "명확한",
            "애매한": "명확하지 않은",
            "분명": "명확한",
            "불분명": "명확하지 않은",
            "분명한": "명확한",
            "불분명한": "명확하지 않은",
            "확실": "의심할 여지가 없는",
            "불확실": "의심스러운",
            "확실한": "의심할 여지가 없는",
            "불확실한": "의심스러운",
            "안전": "위험이 없는",
            "위험": "해로울 수 있는",
            "안전한": "위험이 없는",
            "위험한": "해로울 수 있는",
            "보호": "위험으로부터 지키는",
            "방어": "공격을 막는",
            "보호적": "위험으로부터 지키는",
            "방어적": "공격을 막는",
            "공격": "다른 것을 해치는",
            "해치": "다른 것을 손상시키는",
            "공격적": "다른 것을 해치는",
            "해치는": "다른 것을 손상시키는",
            "손상": "상처를 입는",
            "상처": "아픈 부위",
            "손상된": "상처를 입은",
            "상처받은": "아픈 부위를 가진",
            "치료": "병을 고치는",
            "회복": "원래 상태로 돌아가는",
            "치료적": "병을 고치는",
            "회복적": "원래 상태로 돌아가는",
            "개선": "더 좋게 만드는",
            "향상": "수준이 높아지는",
            "개선된": "더 좋게 만든",
            "향상된": "수준이 높아진",
            "증가": "양이 많아지는",
            "감소": "양이 적어지는",
            "증가한": "양이 많아진",
            "감소한": "양이 적어진",
            "확대": "범위가 넓어지는",
            "축소": "범위가 좁아지는",
            "확대된": "범위가 넓어진",
            "축소된": "범위가 좁아진",
            "확장": "범위가 넓어지는",
            "수축": "범위가 좁아지는",
            "확장된": "범위가 넓어진",
            "수축된": "범위가 좁아진",
            "성장": "크기가 커지는",
            "감소": "크기가 작아지는",
            "성장한": "크기가 커진",
            "감소한": "크기가 작아진",
            "발달": "기능이 향상되는",
            "퇴화": "기능이 약해지는",
            "발달한": "기능이 향상된",
            "퇴화한": "기능이 약해진",
            "진화": "더 나은 형태로 변하는",
            "변화": "형태나 성질이 달라지는",
            "진화한": "더 나은 형태로 변한",
            "변화한": "형태나 성질이 달라진",
            "전환": "다른 방향으로 바뀌는",
            "변환": "다른 형태로 바뀌는",
            "전환된": "다른 방향으로 바뀐",
            "변환된": "다른 형태로 바뀐",
            "변형": "형태가 바뀌는",
            "수정": "잘못된 부분을 고치는",
            "변형된": "형태가 바뀐",
            "수정된": "잘못된 부분을 고친",
            "보정": "틀린 부분을 바로잡는",
            "조정": "적절하게 맞추는",
            "보정된": "틀린 부분을 바로잡은",
            "조정된": "적절하게 맞춘",
            "조절": "적당하게 조정하는",
            "통제": "다른 것을 관리하는",
            "조절된": "적당하게 조정한",
            "통제된": "다른 것을 관리한",
            "관리": "체계적으로 다루는",
            "운영": "체계적으로 관리하는",
            "관리된": "체계적으로 다룬",
            "운영된": "체계적으로 관리한",
            "경영": "사업을 관리하는",
            "경제": "재화와 서비스의 생산과 소비 활동",
            "경영된": "사업을 관리한",
            "경제적": "재화와 서비스의 생산과 소비 활동과 관련된",
            "사회": "사람들이 모여 살아가는 공동체",
            "정치": "국가를 다스리는 일",
            "사회적": "사람들이 모여 살아가는 공동체와 관련된",
            "정치적": "국가를 다스리는 일과 관련된",
            "문화": "한 사회의 생활 양식과 가치관",
            "교육": "지식과 기술을 가르치는",
            "문화적": "한 사회의 생활 양식과 가치관과 관련된",
            "교육적": "지식과 기술을 가르치는",
            "학습": "새로운 것을 배우는",
            "연구": "체계적으로 탐구하는",
            "학습한": "새로운 것을 배운",
            "연구된": "체계적으로 탐구한",
            "개발": "새로운 것을 만들어내는",
            "혁신": "새로운 방법으로 개선하는",
            "개발된": "새로운 것을 만들어낸",
            "혁신된": "새로운 방법으로 개선한",
            "창조": "새로운 것을 만들어내는",
            "발명": "새로운 것을 처음으로 만드는",
            "창조된": "새로운 것을 만들어낸",
            "발명된": "새로운 것을 처음으로 만든",
            "발견": "새로운 것을 찾아내는",
            "탐험": "알려지지 않은 곳을 찾아가는",
            "발견된": "새로운 것을 찾아낸",
            "탐험된": "알려지지 않은 곳을 찾아간",
            "모험": "위험을 무릅쓰고 도전하는",
            "도전": "어려운 일에 맞서는",
            "모험적인": "위험을 무릅쓰고 도전하는",
            "도전적인": "어려운 일에 맞서는",
            "시도": "어떤 일을 해보는",
            "실험": "가설을 검증하는",
            "시도된": "어떤 일을 해본",
            "실험된": "가설을 검증한",
            "검증": "참과 거짓을 확인하는",
            "확인": "정말인지 알아보는",
            "검증된": "참과 거짓을 확인한",
            "확인된": "정말인지 알아본",
            "검사": "자세히 살펴보는",
            "분석": "구성 요소를 나누어 살펴보는",
            "검사된": "자세히 살펴본",
            "분석된": "구성 요소를 나누어 살펴본",
            "종합": "여러 요소를 하나로 합치는",
            "통합": "여러 것을 하나로 합치는",
            "종합된": "여러 요소를 하나로 합친",
            "통합된": "여러 것을 하나로 합친",
            "분리": "하나를 여러 개로 나누는",
            "구분": "서로 다르게 나누는",
            "분리된": "하나를 여러 개로 나눈",
            "구분된": "서로 다르게 나눈",
            "차이": "서로 다른 점",
            "유사": "비슷한 점",
            "차이점": "서로 다른 점",
            "유사점": "비슷한 점",
            "동일": "완전히 같은",
            "일치": "완전히 같은",
            "동일한": "완전히 같은",
            "일치하는": "완전히 같은",
            "대조": "서로 비교하는",
            "비교": "서로 대조하는",
            "대조된": "서로 비교한",
            "비교된": "서로 대조한",
            "대비": "서로 대조하는",
            "상대": "다른 것과의 관계에서 보는",
            "대비된": "서로 대조한",
            "상대적": "다른 것과의 관계에서 보는",
            "절대": "다른 것과 관계없이 보는",
            "객관": "감정에 치우치지 않고 보는",
            "절대적": "다른 것과 관계없이 보는",
            "객관적": "감정에 치우치지 않고 보는",
            "주관": "개인의 감정이나 의견에 따라 보는",
            "공정": "공평하고 정당한",
            "주관적": "개인의 감정이나 의견에 따라 보는",
            "공정한": "공평하고 정당한",
            "불공정": "공평하지 않은",
            "공평": "어느 쪽에도 치우치지 않은",
            "불공정한": "공평하지 않은",
            "공평한": "어느 쪽에도 치우치지 않은",
            "정당": "올바른",
            "부당": "올바르지 않은",
            "정당한": "올바른",
            "부당한": "올바르지 않은",
            "올바른": "정당하고 바른",
            "바른": "정당하고 올바른",
            "그른": "잘못된",
            "잘못": "틀린",
            "올바른": "정당하고 바른",
            "바른": "정당하고 올바른",
            "그른": "잘못된",
            "잘못된": "틀린",
            "틀림": "잘못된",
            "맞음": "올바른",
            "틀린": "잘못된",
            "맞는": "올바른",
            "정확": "틀림없는",
            "부정확": "틀린",
            "정확한": "틀림없는",
            "부정확한": "틀린"
        };
        
        return definitions[word] || `${word}의 의미`;
    }
    
    // detailed_analysis에서 어휘 추출하는 함수 (원본 텍스트 우선)
    async function extractVocabularyFromAnalysis(analysis) {
        console.log('extractVocabularyFromAnalysis called with:', analysis);
        
        // 원본 텍스트가 있으면 우선 사용
        const originalText = getOriginalText();
        if (originalText) {
            return await extractVocabularyFromOriginalText(originalText);
        }
        
        // 원본 텍스트가 없으면 분석 텍스트에서 추출
        return await extractVocabularyFromOriginalText(analysis);
    }
    
    // strengths에서 어휘 추출하는 함수
    async function extractVocabularyFromStrengths(strengths) {
        console.log('extractVocabularyFromStrengths called with:', strengths);
        if (!Array.isArray(strengths)) return null;
        
        const allText = strengths.join(' ');
        return await extractVocabularyFromOriginalText(allText);
    }
    
    // 원본 텍스트 가져오기
    function getOriginalText() {
        const urlParams = new URLSearchParams(window.location.search);
        let text = urlParams.get('text');
        
        if (!text) {
            text = localStorage.getItem('analysis_text');
        }
        
        return text;
    }
        
        // 리라이팅 제안 섹션 업데이트
        window.updateRewritingSuggestion = function(result) {
            const suggestionText = document.querySelector('.suggestion-text');
            const suggestionNote = document.querySelector('.suggestion-note');
            
            if (suggestionText && result.rewritten_text) {
                suggestionText.textContent = result.rewritten_text;
            }
            
            // 제안 노트는 항상 고정 (잘 쓴 글만 보여주기)
            if (suggestionNote) {
                suggestionNote.textContent = '아래는 상위 3% 회원님의 글입니다!';
            }
        }
        
    </script>
</body>
</html>
